<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Konzertkalender</title>

  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.css" rel="stylesheet">

  <!-- FullCalendar JS -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>

  <!-- PapaParse: CSV einlesen -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

  <!-- Dein Stylesheet -->
  <link rel="stylesheet" href="Kneipenchor.css" />

  <style>
    .filter-controls {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin: 1rem 0;
    }
    .event-list {
      display: grid;
      gap: 1rem;
    }
    .event-item {
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 1rem;
      background: #fafafa;
    }
    #calendar {
      max-width: 1000px;
      margin: 2rem auto;
      background: white;
      padding: 1rem;
      border-radius: 1rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .fc-toolbar-title {
      font-size: 1.6rem;
      font-weight: bold;
    }

    body {
      background: var(--bg-color);
    }
  </style>
</head>
<body>

<!-- HEADER -->
<header class="main-header">
  <button class="hamburger" aria-label="Menü öffnen" aria-expanded="false" type="button">
    <span class="bar"></span>
    <span class="bar"></span>
    <span class="bar"></span>
  </button>

  <h1 class="site-title">Kneipenchöre vernetzt</h1>
  <nav class="main-nav">
    <ul class="nav-list">
      <li><a href="index.html" class="nav-link">Startseite</a></li>
      <li><a href="Karte.html" class="nav-link">Kneipenchor-Map</a></li>
      <li><a href="kalender.html" class="nav-link">Kalender</a></li>
      <li><a href="index.html#forum" class="nav-link">Forum</a></li>
      <li><a href="kalender.html" class="nav-link">Kalender</a></li>
    </ul>
    <a href="eintragen.html" class="register-btn">chor eintragen</a>
  </nav>
</header>

<!-- MAIN -->
<main>
  <section class="calendar-section">
    <h2 style="text-align: center;">Konzertkalender der Kneipenchöre</h2>
     <div class="filter-controls">
    <select id="month-filter">
      <option value="">Monat wählen</option>
    </select>
    <select id="chor-filter">
      <option value="">Chor wählen</option>
    </select>
    <select id="ort-filter">
      <option value="">Ort wählen</option>
    </select>
  </div>

  <div id="events" class="event-list"></div>
    <div id="calendar"></div>
  </section>
</main>

<!-- FOOTER -->
<footer class="main-footer">
  <div class="footer-brand">
    <h2 class="footer-title">Kneipenchöre<br>vernetzt</h2>
  </div>
  <nav class="footer-nav">
    <div class="footer-sections">
      <section class="footer-section">
        <h3 class="section-title">Festival</h3>
        <p class="section-content">
          Hier gibt es alle Infos zum jährlich statt findenden Kneipenchor-Festival:<br>
          <a href="https://karlsruherkneipenchor.de/festival/" target="_blank">www.karlsruherkneipenchor.de</a>
        </p>
      </section>
      <section class="footer-section">
        <h3 class="section-title">Kontakt</h3>
        <p class="section-content">
          Jimmy Röck<br>
          c/o Kulturzentrum Tollhaus<br>
          Alter Schlachthof 35<br>
          76131 Karlsruhe<br>
          <a href="mailto:kontakt@kneipenchor.net">kontakt@kneipenchor.net</a>
        </p>
      </section>
      <section class="footer-section">
        <h3 class="section-title">Info</h3>
        <p class="section-content">
          Über uns<br>
          Impressum<br>
          Datenschutz
        </p>
      </section>
    </div>
  </nav>
</footer>

<!-- Kalender-Skript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
  const sheetID = "2PACX-1vRkJDBs--vb6-T67ihZI5jkGclOu50Tsd5YtGvodoWXWEW34LR3TsJJ8nNj_PxsFxusXt5kq6uk_RTh";
  const sheetURL = `https://docs.google.com/spreadsheets/d/e/${sheetID}/pub?output=csv`;

  const filters = {
    Monat: document.getElementById("month-filter"),
    Chor: document.getElementById("chor-filter"),
    Ort: document.getElementById("ort-filter"),
  };

  const eventContainer = document.getElementById("events");
  let alleEvents = [];

  function formatMonat(dateStr) {
    const [jahr, monat] = dateStr.split("-"); // YYYY-MM-DD
    return `${jahr}-${monat}`;
  }

  function populateDropdowns(events) {
    const monate = new Set();
    const orte = new Set();
    const chöre = new Set();

    events.forEach(ev => {
      monate.add(formatMonat(ev.Datum));
      orte.add(ev.Ort);
      chöre.add(ev.Chorname);
    });

    addOptions(filters.Monat, [...monate].sort());
    addOptions(filters.Ort, [...orte].sort());
    addOptions(filters.Chor, [...chöre].sort());
  }

  function addOptions(select, options) {
    options.forEach(opt => {
      const o = document.createElement("option");
      o.value = opt;
      o.textContent = opt;
      select.appendChild(o);
    });
  }

  function filterAndRender() {
    const selectedMonat = filters.Monat.value;
    const selectedOrt = filters.Ort.value;
    const selectedChor = filters.Chor.value;

    const gefiltert = alleEvents.filter(ev => {
      const matchMonat = !selectedMonat || formatMonat(ev.Datum) === selectedMonat;
      const matchOrt = !selectedOrt || ev.Ort === selectedOrt;
      const matchChor = !selectedChor || ev.Chorname === selectedChor;
      return matchMonat && matchOrt && matchChor;
    });

    renderEvents(gefiltert);
  }

  function renderEvents(events) {
    eventContainer.innerHTML = "";
    if (events.length === 0) {
      eventContainer.innerHTML = "<p>Keine Einträge gefunden.</p>";
      return;
    }

    events.forEach(ev => {
      const el = document.createElement("div");
      el.className = "event-item";
      el.innerHTML = `
  <strong>${ev.Eventtitel}</strong><br>
  <em>${ev.Datum} ${ev.Uhrzeit} — ${ev.Ort}</em><br>
  Chor: ${ev.Chorname}<br>
  ${ev.Beschreibung}<br>
  ${ev.Link ? `<a href="${ev.Link}" target="_blank" rel="noopener noreferrer">Mehr Infos</a>` : ""}
`;

      eventContainer.appendChild(el);
    });
  }

  Papa.parse(sheetURL, {
    download: true,
    header: true,
    complete: function(results) {
      alleEvents = results.data.filter(row => row.Datum);
      populateDropdowns(alleEvents);
      renderEvents(alleEvents);
    }
  });

  Object.values(filters).forEach(f => f.addEventListener("change", filterAndRender));
</script>

<!-- Hamburger Script -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const hamburger = document.querySelector('.hamburger');
    const mainNav = document.querySelector('.main-nav');

    hamburger.addEventListener('click', () => {
      const isOpen = mainNav.classList.toggle('open');
      hamburger.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
      hamburger.classList.toggle('active', isOpen);
    });
  });
</script>

</body>
</html>
